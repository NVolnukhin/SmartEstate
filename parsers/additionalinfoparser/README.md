# SmartEstate CianImageParser
## Описание Модуля
Этот модуль предназначен для сбора изображений и истории цен квартир с сайта CIAN.ru и сохранения данных в БД PostgreSQL.

## Структура
```
developerparser/
├── parser_engine.py                # Содержит функции для парсинга изображений и истории цен квартир
├── parse_additional_info.py        # Точка входа для запуска обработки
├── README.md                       # Документация
└── storage                         # Функции для работы с базой данных
      ├── get_cian_urls_db.py       # Функции для получения ссылок на квартиры 
      ├── save_img_links_db.py      # Функции для сохранения ссылок на изображения
      └── save_price_history_db.py  # Функции для сохранения ссылок на изображения
```
## Требования
- Python 3.8+
- Установленные зависимости
  - selenium 
  - beautifulsoup4 
  - psycopg2
  - python-dotenv
- ChromeDriver (совместимый с вашей версией Chrome)
- Доступ к PostgreSQL с соответствующими правами



##  Установка
1. Клонируйте репозиторий:
```commandline
git clone https://git.iu7.bmstu.ru/sgn3-prog/sgn3-prog-it-2025/ghostbusters.git
cd backend/parser/additionalinfoparser
```

2. Установите зависимости:

    ```pip install -r requirements.txt```

3. Убедитесь, что ChromeDriver установлен и доступен в PATH

## Настройка
1. Создайте файл .env в корне проекта:
```
DB_NAME=your_database
DB_USER=your_username
DB_PASSWORD=your_password
DB_HOST=localhost
DB_PORT=5432
```
2. Убедитесь, что ChromeDriver установлен и доступен в PATH

## Структура БД:

Модуль обновляет таблицу Flats, добавляя URL изображений в поле Images (тип JSONB)

И сохраняет в таблицу PriceHistories информацию об истории цен

## Особенности работы
1. Обработка происходит пакетами (по умолчанию 5 квартир за раз)

2. Между пакетами стоит задержка 2 секунды (time.sleep)

3. Для каждой квартиры собираются:

   - Основное изображение 
   - План этажа (если есть)
   - Дополнительные фотографии
   - История всех цен и дата изменения

4. Прогресс обработки выводится в консоль

## Параметры конфигурации
Можно настроить:
- BATCH_SIZE - количество квартир, обрабатываемых за один пакет 
- Время задержки между пакетами



## Возможные улучшения
1. Добавить обработку ошибок при загрузке страниц
2. Реализовать повторные попытки для неудачных запросов
3. Добавить логирование в файл
4. Реализовать многопоточную обработку



